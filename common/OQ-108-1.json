{
  "title": "Notebook Sharing RBAC Validation",
  "test_description": "Validates that notebook sharing RBAC is properly enforced by checking permissions on a specific notebook and ensuring proper access controls are in place",
  "version": "1.0",
  "test_code": "OQ-108-1",
  "test_seq": 1,
  "test_suite": "OQ-108",
  "test_suite_title": "Collaboration Features",
  "category": "OQ",
  "api_calls": [
    {
      "step": 1,
      "name": "check_notebook_permissions",
      "method": "GET",
      "api_url": "${workspace_url}/api/2.0/permissions/notebooks/2040981268711970",
      "headers": {
        "Authorization": "Bearer ${token}",
        "Content-Type": "application/json"
      },
      "post_processing": "function processStep(responseData, currentVariables) { return currentVariables; }"
    },
    {
      "step": 2,
      "name": "check_workspace_permissions",
      "method": "GET",
      "api_url": "${workspace_url}/api/2.0/permissions/workspace",
      "headers": {
        "Authorization": "Bearer ${token}",
        "Content-Type": "application/json"
      },
      "post_processing": "function processStep(responseData, currentVariables) { return currentVariables; }"
    }
  ],
  "response_schema": null,
  "parser_code": "function aggregateResults(stepResults) { try { const notebookStep = stepResults.check_notebook_permissions; const workspaceStep = stepResults.check_workspace_permissions; let hasRbac = false; let message = 'RBAC not properly configured'; let validationDetails = []; if (notebookStep && notebookStep.status === 200 && notebookStep.data && notebookStep.data.access_control_list) { validationDetails.push('✓ Notebook permissions API accessible'); const accessControlList = notebookStep.data.access_control_list; for (let i = 0; i < accessControlList.length; i++) { const aclEntry = accessControlList[i]; const allPermissions = aclEntry.all_permissions || []; for (let j = 0; j < allPermissions.length; j++) { const permission = allPermissions[j]; const permissionLevel = permission.permission_level; if (permissionLevel === 'CAN_READ' || permissionLevel === 'CAN_MANAGE' || permissionLevel === 'CAN_EDIT') { hasRbac = true; break; } } if (hasRbac) break; } if (hasRbac) { message = 'RBAC enforcement verified'; validationDetails.push('✓ Found proper access control permissions'); } else { validationDetails.push('⚠ No standard permissions found in notebook ACL'); } } else if (notebookStep && notebookStep.status === 404) { validationDetails.push('⚠ Notebook not found, checking workspace permissions'); if (workspaceStep && workspaceStep.status === 200 && workspaceStep.data && workspaceStep.data.access_control_list) { validationDetails.push('✓ Workspace permissions API accessible'); const workspaceAcl = workspaceStep.data.access_control_list; for (let k = 0; k < workspaceAcl.length; k++) { const workspaceEntry = workspaceAcl[k]; const workspacePermissions = workspaceEntry.all_permissions || []; for (let l = 0; l < workspacePermissions.length; l++) { const workspacePermission = workspacePermissions[l]; const workspaceLevel = workspacePermission.permission_level; if (workspaceLevel === 'CAN_READ' || workspaceLevel === 'CAN_RUN' || workspaceLevel === 'CAN_MANAGE' || workspaceLevel === 'CAN_EDIT') { hasRbac = true; break; } } if (hasRbac) break; } if (hasRbac) { message = 'Workspace-level RBAC enforcement verified'; validationDetails.push('✓ Found proper workspace access control permissions'); } else { validationDetails.push('✗ No proper permissions found at workspace level'); } } else { validationDetails.push('✗ Unable to validate workspace permissions'); } } else if (notebookStep && notebookStep.status === 403) { validationDetails.push('✗ Access denied to notebook permissions API'); } else { validationDetails.push('✗ Failed to check notebook permissions'); } const status = hasRbac ? 'pass' : 'fail'; const code = hasRbac ? 'RBAC_ENFORCEMENT_VERIFIED' : 'RBAC_MISSING_PERMISSIONS'; return { status: status, message: message, code: code, test_id: 'OQ-108-1', title: 'Notebook Sharing RBAC Validation' }; } catch (error) { return { status: 'fail', message: 'Error during notebook sharing RBAC validation: ' + error.toString(), code: 'RBAC_VALIDATION_ERROR', test_id: 'OQ-108-1', title: 'Notebook Sharing RBAC Validation' }; } }"
} 