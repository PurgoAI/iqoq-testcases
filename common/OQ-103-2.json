{
  "title": "Blood Pressure and Heart Rate Validation",
  "test_description": "Blood Pressure and Heart Rate Validation - Validates systolic BP (90-180 mmHg), diastolic BP (60-120 mmHg), and heart rate (< 0.1% null values allowed).",
  "version": "1.0",
  "test_code": "OQ-103-2",
  "test_seq": 2,
  "test_suite": "OQ-103",
  "test_suite_title": "Audit Trail",
  "category": "OQ",
  "api_calls": [
    {
      "step": 1,
      "name": "validate_blood_pressure_heart_rate",
      "method": "POST",
      "api_url": "${workspace_url}/api/2.0/sql/statements",
      "headers": {
        "Authorization": "Bearer ${token}",
        "Content-Type": "application/json"
      },
      "payload": {
        "statement": "SELECT COUNT(*) as total_records, SUM(CASE WHEN systolic_bp IS NULL THEN 1 ELSE 0 END) as null_systolic, SUM(CASE WHEN diastolic_bp IS NULL THEN 1 ELSE 0 END) as null_diastolic, SUM(CASE WHEN heart_rate IS NULL THEN 1 ELSE 0 END) as null_heart_rate, SUM(CASE WHEN systolic_bp < 90 OR systolic_bp > 180 THEN 1 ELSE 0 END) as invalid_systolic, SUM(CASE WHEN diastolic_bp < 60 OR diastolic_bp > 120 THEN 1 ELSE 0 END) as invalid_diastolic FROM iq_oq_demo.silver.sdtm_dm WHERE systolic_bp IS NOT NULL OR diastolic_bp IS NOT NULL OR heart_rate IS NOT NULL",
        "warehouse_id": "${warehouse_id}",
        "wait_timeout": "30s"
      },
      "post_processing": "function processStep(responseData, currentVariables) { return currentVariables; }"
    }
  ],
  "response_schema": null,
  "parser_code": "function aggregateResults(stepResults) { const bpStep = stepResults.validate_blood_pressure_heart_rate; if (!bpStep || !bpStep.data) { return { status: 'fail', message: 'No response received from blood pressure validation query', code: 'BP_HR_NO_RESULTS', test_id: 'OQ-103-2', title: 'Blood Pressure and Heart Rate Validation' }; } const data = bpStep.data; if (data.status && data.status.state === 'SUCCEEDED' && data.result && data.result.data_array && data.result.data_array.length > 0) { const dataArray = data.result.data_array; const row = dataArray[0]; const totalRecords = parseInt(row[0]) || 0; const nullSystolic = parseInt(row[1]) || 0; const nullDiastolic = parseInt(row[2]) || 0; const nullHeartRate = parseInt(row[3]) || 0; const invalidSystolic = parseInt(row[4]) || 0; const invalidDiastolic = parseInt(row[5]) || 0; if (totalRecords === 0) { return { status: 'fail', message: 'No records found in sdtm_dm table for validation', code: 'BP_HR_NO_DATA', test_id: 'OQ-103-2', title: 'Blood Pressure and Heart Rate Validation' }; } const nullSystolicPct = ((nullSystolic / totalRecords) * 100); const nullDiastolicPct = ((nullDiastolic / totalRecords) * 100); const nullHeartRatePct = ((nullHeartRate / totalRecords) * 100); const invalidSystolicPct = ((invalidSystolic / totalRecords) * 100); const invalidDiastolicPct = ((invalidDiastolic / totalRecords) * 100); const heartRateThreshold = 0.1; const validationPassed = nullSystolicPct <= heartRateThreshold && nullDiastolicPct <= heartRateThreshold && nullHeartRatePct <= heartRateThreshold && invalidSystolicPct === 0 && invalidDiastolicPct === 0; if (validationPassed) { return { status: 'pass', message: 'Validation passed: Null systolic: ' + nullSystolicPct.toFixed(2) + '%, Null diastolic: ' + nullDiastolicPct.toFixed(2) + '%, Null heart rate: ' + nullHeartRatePct.toFixed(2) + '%, Invalid systolic: ' + invalidSystolicPct.toFixed(2) + '%, Invalid diastolic: ' + invalidDiastolicPct.toFixed(2) + '%', code: 'BP_HR_VALIDATION_OK', test_id: 'OQ-103-2', title: 'Blood Pressure and Heart Rate Validation' }; } else { return { status: 'fail', message: 'Validation failed: Null systolic: ' + nullSystolicPct.toFixed(2) + '%, Null diastolic: ' + nullDiastolicPct.toFixed(2) + '%, Null heart rate: ' + nullHeartRatePct.toFixed(2) + '%, Invalid systolic: ' + invalidSystolicPct.toFixed(2) + '%, Invalid diastolic: ' + invalidDiastolicPct.toFixed(2) + '%', code: 'BP_HR_VALIDATION_FAILED', test_id: 'OQ-103-2', title: 'Blood Pressure and Heart Rate Validation' }; } } else if (data.status && data.status.state !== 'SUCCEEDED') { return { status: 'fail', message: 'Failed to execute blood pressure and heart rate validation query', code: 'BP_HR_QUERY_ERROR', test_id: 'OQ-103-2', title: 'Blood Pressure and Heart Rate Validation' }; } else { return { status: 'fail', message: 'No data returned from blood pressure and heart rate validation query', code: 'BP_HR_NO_RESULTS', test_id: 'OQ-103-2', title: 'Blood Pressure and Heart Rate Validation' }; } }"
} 