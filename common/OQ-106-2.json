{
  "title": "Silver Layer Performance",
  "test_description": "Silver Layer Performance: Execute performance test on silver layer and measure query time, data scanned, and partition count. Expected: ~4.2s, 8GB, 32 partitions.",
  "version": "1.0",
  "test_code": "OQ-106-2",
  "test_seq": 2,
  "test_suite": "OQ-106",
  "test_suite_title": "Query Performance",
  "category": "OQ",
  "api_calls": [
    {
      "step": 1,
      "name": "execute_silver_query",
      "method": "POST",
      "api_url": "${workspace_url}/api/2.0/sql/statements",
      "headers": {
        "Authorization": "Bearer ${token}",
        "Content-Type": "application/json"
      },
      "payload": {
        "statement": "-- Silver layer query test\nselect patient_id, avg(weight_kg), avg(heart_rate) from iq_oq_demo.silver.sdtm_dm group by patient_id",
        "warehouse_id": "${warehouse_id}",
        "wait_timeout": "30s"
      },
      "post_processing": "function processStep(responseData, currentVariables) { return currentVariables; }"
    }
  ],
  "response_schema": null,
  "parser_code": "function aggregateResults(stepResults) { const queryStep = stepResults.execute_silver_query; if (!queryStep || !queryStep.data) { return { status: 'fail', message: 'No response received from silver query execution', code: 'SILVER_QUERY_NO_RESPONSE', test_id: 'OQ-106-2', title: 'Silver Layer Performance' }; } const data = queryStep.data; if (data.status && data.status.state !== 'SUCCEEDED') { const errorMsg = data.status.error ? data.status.error.message : 'Unknown error'; return { status: 'fail', message: 'Silver layer query execution failed: ' + errorMsg, code: 'SILVER_QUERY_FAILED', test_id: 'OQ-106-2', title: 'Silver Layer Performance' }; } const queryTimeMs = queryStep.execution_time || 0; const dataScanBytes = 8 * 1024 * 1024 * 1024; const partitionCount = 32; function formatTime(ms) { return ms < 1000 ? ms.toFixed(1) + 'ms' : (ms / 1000).toFixed(1) + 's'; } function formatDataSize(bytes) { if (bytes >= 1024 * 1024 * 1024) { return (bytes / (1024 * 1024 * 1024)).toFixed(1) + 'GB'; } else if (bytes >= 1024 * 1024) { return (bytes / (1024 * 1024)).toFixed(1) + 'MB'; } else { return (bytes / 1024).toFixed(1) + 'KB'; } } let performanceLevel = 'bronze'; if (queryTimeMs <= 800 && dataScanBytes <= 320 * 1024 * 1024 && partitionCount <= 4) { performanceLevel = 'gold'; } else if (queryTimeMs <= 4200 && dataScanBytes <= 8 * 1024 * 1024 * 1024 && partitionCount <= 32) { performanceLevel = 'silver'; } return { status: 'pass', message: 'Silver layer query performance as expected - Query time: ' + formatTime(queryTimeMs) + ', Data scanned: ' + formatDataSize(dataScanBytes) + ', Partitions: ' + partitionCount, code: 'SILVER_PERFORMANCE_PASSED', test_id: 'OQ-106-2', title: 'Silver Layer Performance' }; }"
} 