{
  "title": "Workspace ESC Enablement",
  "test_description": "Validate if workspace ESC (Enhanced Security Controls) is enabled",
  "version": "1.0",
  "test_code": "IQ-101-4",
  "test_seq": 4,
  "test_suite": "IQ-101",
  "test_suite_title": "Databricks Workspace Setup",
  "category": "IQ",
  "api_calls": [
    {
      "step": 1,
      "name": "get_workspace_esc",
      "method": "GET",
      "api_url": "https://management.azure.com/subscriptions/${subscription_id}/resourceGroups/${resource_group}/providers/Microsoft.Databricks/workspaces/${workspace_name}?api-version=2024-05-01",
      "headers": {
        "Authorization": "Bearer ${azure_token}"
      },
      "payload": {},
      "post_processing": "function processStep(responseData, currentVariables) { return currentVariables; }"
    }
  ],
  "response_schema": null,
  "parser_code": "function aggregateResults(stepResults) { const escStep = stepResults.get_workspace_esc; const expected_result = 'ESC: Enabled'; let actual_result = 'ESC: Unknown'; if (escStep.error) { return { status: 'fail', message: 'No response received from API', code: 'NO_RESPONSE', test_id: 'IQ-101-4', title: 'Workspace ESC Enablement', expected_result, actual_result }; } const apiOutput = escStep.data; if (!apiOutput || !apiOutput.properties || !apiOutput.properties.enhancedSecurityCompliance) { return { status: 'fail', message: 'ESC settings not found in workspace', code: 'ESC_NOT_FOUND', test_id: 'IQ-101-4', title: 'Workspace ESC Enablement', expected_result, actual_result }; } const esc = apiOutput.properties.enhancedSecurityCompliance; const complianceProfile = esc.complianceSecurityProfile; if (complianceProfile && complianceProfile.value === 'Enabled') { const standards = complianceProfile.complianceStandards || []; actual_result = standards.length > 0 ? `ESC: Enabled (${standards.join(', ')})` : 'ESC: Enabled'; return { status: 'pass', message: 'ESC compliance is enabled', code: 'ESC_ENABLED', test_id: 'IQ-101-4', title: 'Workspace ESC Enablement', expected_result, actual_result }; } else { actual_result = complianceProfile ? `ESC: ${complianceProfile.value}` : 'ESC: Not configured'; return { status: 'fail', message: 'ESC compliance is not enabled', code: 'ESC_NOT_ENABLED', test_id: 'IQ-101-4', title: 'Workspace ESC Enablement', expected_result, actual_result }; } }",
  "manual_procedure": "As an account admin, go to the account console. Click Workspaces. Click on your workspaceâ€™s name. Click Security and compliance. To enable the compliance security profile, next to the Compliance security profile, click Enable. In the Compliance security profile dialog, optionally select compliance standards and click Save."
}